<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="OwnTracks.org" /><link rel="canonical" href="http://owntracks.org/tech/json/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>JSON - OwnTracks Booklet</title>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link href="../../extra.css" rel="stylesheet">
    
      <script>
        // Current page data
        var mkdocs_page_name = "JSON";
        var mkdocs_page_input_path = "tech/json.md";
        var mkdocs_page_url = "/tech/json/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> OwnTracks Booklet
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Intro</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/whathow/">What it does</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/quicksetup/">Quicksetup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/clients/">Clients</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/apps/">Apps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/comparison/">Comparison</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/location/">Location</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">JSON</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../http/">HTTP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../program/">Code</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sundry</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../privacy/">Privacy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../people/">People</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/">Answers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../press/">Press</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">OwnTracks Booklet</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API</li>
      <li class="breadcrumb-item active">JSON</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/owntracks/booklet/edit/master/docs/tech/json.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="types">Types</h2>
<p>OwnTracks uses <a href="http://www.json.org">JSON</a> format for its message payloads. The different payload types are identified by a mandatory <code>_type</code> element. Depending on the app platform, different payload types are supported.</p>
<table>
<thead>
<tr>
<th><code>_type</code></th>
<th style="text-align: center;">iOS</th>
<th style="text-align: center;">Android</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beacon</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
</tr>
<tr>
<td><code>card</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>cmd</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>configuration</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>encrypted</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>location</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>lwt</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>request</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
</tr>
<tr>
<td><code>steps</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">N</td>
</tr>
<tr>
<td><code>transition</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>waypoint</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
<tr>
<td><code>waypoints</code></td>
<td style="text-align: center;">Y</td>
<td style="text-align: center;">Y</td>
</tr>
</tbody>
</table>
<h2 id="topics">Topics</h2>
<p>In MQTT mode the apps publish to:</p>
<ul>
<li><code>owntracks/user/device</code> with <code>_type=location</code> for location updates, and with <code>_type=lwt</code></li>
<li><code>owntracks/user/device/cmd</code> with <code>_type=cmd</code> for remote commands</li>
<li><code>owntracks/user/device/event</code> with <code>_type=transition</code> for enter/leave events</li>
<li><code>owntracks/user/device/step</code> to report step counter</li>
<li><code>owntracks/user/device/beacon</code> for beacon ranging</li>
<li><code>owntracks/user/device/dump</code> for config dumps</li>
</ul>
<p>In MQTT mode apps subscribe to:</p>
<ul>
<li><code>owntracks/user/device/cmd</code> if remote commands are enabled</li>
<li><code>owntracks/+/+</code> for seeing other user's locations, depending on broker ACL</li>
<li><code>owntracks/+/+/event</code> for transition messages (<code>enter</code>/<code>leave</code>)</li>
<li><code>owntracks/+/+/info</code> for obtaining <a href="../../features/card/">cards</a>.</li>
</ul>
<p>In HTTP mode the apps POST their data to a single endpoint you configure.</p>
<h2 id="_typelocation"><code>_type=location</code></h2>
<p>This location object describes the location of the device that reported it.</p>
<pre><code class="language-json">{
    &quot;_type&quot; : &quot;location&quot;,
    elements
}
</code></pre>
<ul>
<li><code>acc</code> Accuracy of the reported location in meters without unit <em>(iOS,Android/integer/meters/optional)</em></li>
<li><code>alt</code> Altitude measured above sea level <em>(iOS,Android/integer/meters/optional)</em></li>
<li><code>batt</code> Device battery level <em>(iOS,Android/integer/percent/optional)</em></li>
<li><code>bs</code> Battery Status 0=unknown, 1=unplugged, 2=charging, 3=full  <em>(iOS, Android)</em></li>
<li><code>cog</code> Course over ground <em>(iOS/integer/degree/optional)</em></li>
<li><code>lat</code> latitude <em>(iOS,Android/float/degree/required)</em></li>
<li><code>lon</code> longitude <em>(iOS,Android/float/degree/required)</em></li>
<li><code>rad</code> radius around the region when entering/leaving <em>(iOS/integer/meters/optional)</em></li>
<li><code>t</code> trigger for the location report <em>(iOS,Android/string/optional)</em><ul>
<li><code>p</code> ping issued randomly by background task <em>(iOS,Android)</em></li>
<li><code>c</code> circular region enter/leave event <em>(iOS,Android)</em></li>
<li><code>b</code> beacon region enter/leave event <em>(iOS)</em></li>
<li><code>r</code> response to a reportLocation cmd message <em>(iOS,Android)</em></li>
<li><code>u</code> manual publish requested by the user <em>(iOS,Android)</em></li>
<li><code>t</code> timer based publish in move move <em>(iOS)</em></li>
<li><code>v</code> updated by <code>Settings/Privacy/Locations Services/System Services/Frequent Locations</code> monitoring <em>(iOS)</em></li>
</ul>
</li>
<li><code>tid</code> Tracker ID used to display the initials of a user <em>(iOS,Android/string/optional)</em> required for <code>http</code> mode</li>
<li><code>tst</code> UNIX <a href="http://en.wikipedia.org/wiki/Unix_time">epoch timestamp</a> in seconds of the location fix <em>(iOS,Android/integer/epoch/required)</em></li>
<li><code>vac</code> vertical accuracy of the <code>alt</code> element <em>(iOS/integer/meters/optional)</em></li>
<li><code>vel</code> velocity <em>(iOS,Android/integer/kmh/optional)</em></li>
<li><code>p</code> barometric pressure <em>(iOS/float/kPa/optional/extended data)</em></li>
<li><code>poi</code> point of interest name <em>(iOS/string/optional)</em></li>
<li><code>conn</code> Internet connectivity status (route to host) when the message is created <em>(iOS,Android/string/optional/extended data)</em><ul>
<li><code>w</code> phone is connected to a WiFi connection <em>(iOS,Android)</em></li>
<li><code>o</code> phone is offline <em>(iOS,Android)</em></li>
<li><code>m</code> mobile data <em>(iOS,Android)</em></li>
</ul>
</li>
<li><code>tag</code> name of the tag <em>(iOS/string/optional)</em></li>
<li><code>topic</code> (only in HTTP payloads) contains the original publish topic (e.g. <code>owntracks/jane/phone</code>). <em>(iOS,Android &gt;= 2.4,string)</em></li>
<li><code>inregions</code> contains a list of regions the device is currently in (e.g. <code>["Home","Garage"]</code>). Might be empty. <em>(iOS,Android/list of strings/optional)</em></li>
<li><code>inrids</code> contains a list of region IDs the device is currently in (e.g. <code>["6da9cf","3defa7"]</code>). Might be empty. <em>(iOS,Android/list of strings/optional)</em></li>
<li><code>SSID</code>, if available, is the unique name of the WLAN. <em>(iOS,string/optional)</em></li>
<li><code>BSSID</code>, if available, identifies the access point. <em>(iOS,string/optional)</em></li>
<li><code>created_at</code> identifies the time at which the message is constructed (vs. <code>tst</code> which is the timestamp of the GPS fix) <em>(iOS,Android)</em></li>
<li><code>m</code> identifies the monitoring mode at which the message is constructed (<em>significant</em>=<code>1</code>, <em>move</em>=<code>2</code>)  <em>(iOS/integer/optional)</em></li>
</ul>
<h4 id="notes">Notes</h4>
<ul>
<li>The <code>tst</code> in a ping is a <a href="https://github.com/owntracks/ios/issues/197">current timestamp</a>, so that it doesn't look like a duplicate.</li>
<li>The <code>tid</code> defaults to the last two characters of the topic</li>
<li>A missing <code>t</code> element also indicates an automatic location update</li>
<li>A publish of <code>"_type": "location"</code> with a <code>"b"</code> trigger is sent when an iOS device enters or leaves a beacon in addition to a <code>"_type": "transition"</code>: if somebody leaves and enters his home without having left the radius of detection for significant changes, a subscriber to his main topic would otherwise not get notified of any location change although beacon or circular region enter and leave transitions were generated.</li>
<li>The <code>acc</code>, <code>alt</code>, <code>cog</code>, <code>vac</code>, <code>vel</code> elements are only added if they are not zero</li>
<li>Some Android devices always return 0 for <code>alt</code> or <code>vel</code></li>
<li>Elements marked with <em>extended data</em> are only added if <code>extendedData=true</code> is configured</li>
</ul>
<h3 id="greenwich">Greenwich</h3>
<p>The OwnTracks edition of the <a href="http://www.choral.it/greenwich&amp;menu2=795">Choral Greenwich</a> device reports the following additional elements in a <code>_type=location</code> message:</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;location&quot;,
    elements
}
</code></pre>
<ul>
<li><code>alt</code> Altitude measured above sea level <em>(integer/meters/optional)</em></li>
<li><code>batt</code> Device battery level <em>(integer/percent/optional)</em></li>
<li><code>cog</code> Course over ground <em>(integer/degree/optional)</em></li>
<li><code>dist</code> Distance travelled since the last location report <em>(integer/meters/optional)</em></li>
<li><code>trip</code> Distance travelled since the last reboot <em>(integer/meters/optional)</em></li>
<li><code>vel</code> velocity <em>(integer/kmh/optional)</em></li>
<li><code>t</code> trigger for the location report <em>(string/optional)</em><ul>
<li><code>f</code> First publish after reboot</li>
<li><code>m</code> Manually requested locations (e.g. by publishing to <code>/cmd</code>)</li>
<li><code>t</code> Time for location published because device is moving.</li>
<li><code>T</code> Time for location published because of time passed while device is stationary (<code>maxInterval</code>)</li>
<li><code>k</code> Transitioning from <em>move</em> to <em>stationary</em> (park)</li>
<li><code>v</code> Transitioning from <em>stationary</em> to <em>move</em> (mo-v-e)</li>
<li><code>l</code> Last known position when device lost GPS fix</li>
<li><code>L</code> Last known position before gracefull shutdown</li>
</ul>
</li>
</ul>
<h4 id="notes_1">Notes</h4>
<ul>
<li>The device can be configured to produce or not produce fields marked as <em>optional</em></li>
</ul>
<h3 id="queclink">Queclink</h3>
<p>OwnTracks works with a selection of trackers by <a href="http://www.queclink.com">Queclink</a>, for which the protocol conversion is done via <a href="https://github.com/jpmens/qtripp">qtripp</a>.
Queclink devices report the following additional elements in a <code>_type=location</code> message:</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;location&quot;,
    elements
}
</code></pre>
<ul>
<li><code>t</code> trigger for the location report <em>(string/optional)</em><ul>
<li><code>o</code> Corner</li>
<li><code>M</code> Mileage</li>
<li><code>!</code> Tow or fake tow or sensor without ignition</li>
<li><code>a</code> motionless (aka park)</li>
<li><code>i</code> ignition on</li>
<li><code>I</code> ignition off</li>
<li><code>e</code> external power off</li>
<li><code>E</code> external power ON</li>
<li><code>1</code> Devices powered up</li>
<li><code>2</code> Battery stop charging</li>
<li><code>3</code> Battery start charging</li>
<li><code>9</code> Battery power low</li>
<li><code>h</code> harsh behavior</li>
<li><code>s</code> speed alarm</li>
</ul>
</li>
<li><code>odometer</code> total distance of the device <em>(float/kilometers/optional)</em></li>
<li><code>hmc</code> total hours of operation <em>(float/seconds/optional)</em></li>
<li><code>ubatt</code> voltage of the battery <em>(float/volts/optional)</em></li>
<li><code>uext</code> voltage of the external power source <em>(float/volts/optional)</em></li>
<li><code>vin</code> vehicle identification number <em>(string/optional)</em></li>
<li><code>imei</code> identification number <em>(string/optional)</em></li>
<li><code>name</code> vehicle name <em>(string/optional)</em></li>
<li><code>don</code> is duration since ignition on <em>(float/seconds/optional)</em></li>
<li><code>doff</code> is duration since ignition off <em>(float/seconds/optional)</em></li>
<li><code>aiv</code> is analog input voltage <em>(float/volts/optional)</em></li>
<li><code>rpm</code> is engine rounds per minute <em>(float/rounds per minute/optional)</em></li>
<li><code>fcon</code> is fuel consumption <em>(float/L per 100km/optional)</em></li>
<li><code>flvl</code> is fuel level <em>(float/percent/optional)</em></li>
<li><code>anum</code> is number of analog inputs <em>(integer/optional)</em></li>
<li><code>adid-xx</code> is id of analog input number xx <em>(string/optional)</em></li>
<li><code>adty-xx</code> is type of analog input number xx <em>(string/optional)</em></li>
<li><code>adda-xx</code> is data of analog input number xx <em>(string/optional)</em></li>
<li><code>temp_c-xx</code> is temperature of analog input number xx <em>(float/celsius/optional)</em></li>
<li><code>can</code> is can data <em>(string/optional)</em></li>
<li><code>din1</code> is status of digital input 1 <em>(boolean/optional)</em></li>
<li><code>din2</code> is status of digital input 2 <em>(boolean/optional)</em></li>
<li><code>dout1</code> is status of digital output 1 <em>(boolean/optional)</em></li>
<li><code>dout2</code> is status of digital output 2 <em>(boolean/optional)</em></li>
<li><code>ign</code> is status of ignition <em>(boolean/optional)</em></li>
<li><code>motion</code> is motion status <em>(boolean/optional)</em></li>
<li><code>tow</code> is status of tow sensor <em>(boolean/optional)</em></li>
<li><code>fake</code> is status of fake tow sensor <em>(boolean/optional)</em></li>
<li><code>sens</code> is status of motion sensor <em>(boolean/optional)</em></li>
<li><code>sent</code> is epoch when message was sent <em>(integer/epoch/optional)</em></li>
<li><code>mcc</code> is mobile country code <em>(integer/optional)</em></li>
<li><code>mnc</code> is mobile network code <em>(integer/optional)</em></li>
<li><code>lac</code> is location area code <em>(string/optional)</em></li>
<li><code>cid</code> is cell id <em>(string/optional)</em></li>
<li><code>nmds</code> is non movement detection status <em>(boolean/optional)</em></li>
<li><code>rit</code> queclink record id and type <em>(integer/optional)</em></li>
<li><code>rty</code> queclink record type <em>(integer/optional)</em></li>
<li><code>rid</code> queclink record id <em>(integer/optional)</em></li>
<li><code>mst</code> queclink motion state <em>(integer/optional)</em></li>
<li><code>count</code> is counter of message <em>(string/optional)</em></li>
<li><code>raw_line</code> raw data <em>(string/optional)</em></li>
<li><code>counter</code> number of ignored positions <em>(integer/optional)</em></li>
<li><code>ignored</code> indicates counter positions have been ignored <em>(boolean/optional)</em></li>
</ul>
<h4 id="notes_2">Notes</h4>
<ul>
<li>The device can be configured to produce or not produce fields marked as <em>optional</em></li>
</ul>
<h2 id="_typelwt"><code>_type=lwt</code></h2>
<p>A <em>last will and testament</em> is published automatically by the MQTT broker when it loses contact with the app. This typically looks like this:</p>
<pre><code class="language-json">{
    &quot;_type&quot;:&quot;lwt&quot;,
    elements
}
</code></pre>
<ul>
<li><code>tst</code> UNIX <a href="http://en.wikipedia.org/wiki/Unix_time">epoch timestamp</a> at which the app first connected <em>(iOS,Android/integer/epoch/required)</em></li>
</ul>
<h2 id="_typewaypoint"><code>_type=waypoint</code></h2>
<p>Waypoints / regions denote specific geographical regions that you want to keep track of. You define a region in the OwnTracks app, and OwnTracks publishes this waypoint to the topic branch <code>../waypoint</code> (singular). OwnTracks also monitors these waypoints and will publish <code>{_type: "transition", ...}</code> message when entering or leaving the region. A waypoint may also define a BLE <a href="../../features/beacons/">Beacon</a> instead of a geographical region.</p>
<pre><code class="language-json">{
    &quot;_type&quot;  : &quot;waypoint&quot;,
    elements
}
</code></pre>
<ul>
<li><code>desc</code> Name of the waypoint that is included in the sent transition message, copied into the <code>location</code> message <code>inregions</code> array when a current position is within a region. <em>(iOS,Android,string/required)</em></li>
<li><code>lat</code> Latitude  <em>(iOS,Android/float/meters/optional)</em></li>
<li><code>lon</code> Longitude <em>(iOS,Android/float/meters/optional)</em></li>
<li><code>rad</code> Radius around the latitude and longitude coordinates <em>(iOS,Android/integer/meters/optional)</em></li>
<li><code>tst</code> Timestamp of creation of region, copied into the <code>wtst</code> element of the transition message <em>(iOS,Android/integer/epoch/required)</em></li>
<li><code>uuid</code> UUID of the BLE Beacon <em>(iOS/string/optional)</em></li>
<li><code>major</code> Major number of the BLE Beacon <em>(iOS/integer/optional)</em></li>
<li><code>minor</code>  Minor number of the BLE Beacon_(iOS/integer/optional)_</li>
<li><code>rid</code>  region ID, created automatically, copied into the <code>location</code> payload <code>inrids</code> array (iOS/string)_</li>
</ul>
<h4 id="notes_3">Notes</h4>
<ul>
<li>In iOS version &gt;= 9.1.0 the last three elements (uuid, major, and minor) are used to configure Beacon waypoints instead of encoding these values into the <code>desc</code> element.</li>
<li>If <code>lat</code>, <code>lon</code> and <code>rad</code> elements are present, transition messages are sent when entering and leaving the geographical region</li>
<li>If <code>uuid</code>, <code>major</code>, <code>minor</code> elements are present, BLE becons with that specifications are monitored</li>
<li>Beacons and Geographical regions can be defined together</li>
<li>Waypoint messages are published non-retained because the second waypoint would overwrite the first: a client would only get the last one which makes no sense. Your application will typically store waypoints to some kind of persistent storage.</li>
<li>Waypoints are sent to the broker and transition messages contain a <code>desc</code> and <code>event</code> element.</li>
</ul>
<h2 id="_typetransition"><code>_type=transition</code></h2>
<p>A transition message is sent, when entering or leaving a previously configured geographical region or BLE Beacon. In addition to the coordinates where the event fired, the message contains the timestamp of the waypoint creation as well as the event that triggered the transition message with its description. MQTT transition messages are published non retained.</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;transition&quot;,
    elements
}
</code></pre>
<ul>
<li><code>wtst</code> Timestamp of waypoint creation <em>(iOS,Android/integer/epoch/required)</em></li>
<li><code>lat</code> Latitude at which the event occured <em>(iOS,Android/float/meters/optional)</em></li>
<li><code>lon</code> Longitue at which the event occured <em>(iOS,Android/float/meters/optional)</em></li>
<li><code>tst</code> Timestamp at which the event occured <em>(iOS,Android/integer/epoch/required)</em></li>
<li><code>acc</code> Accuracy of the geographical coordinates <em>(iOS,Android/float/meters/required)</em></li>
<li><code>tid</code> Tracker ID of the <em>(iOS/string/none/optional)</em> required in http mode.</li>
<li><code>event</code> Event that triggered the transition (iOS,Android/string/required)<ul>
<li><code>enter</code> The device entered the defined geographical region or BLE Beacon range <em>(iOS)</em></li>
<li><code>leave</code> The device left the defined geographical region or BLE Beacon range <em>(iOS)</em></li>
</ul>
</li>
<li><code>desc</code> Name of the waypoint <em>(iOS,Android/string/optional)</em></li>
<li><code>t</code> Trigger of the event <em>(iOS,Android/string/optional)</em><ul>
<li><code>c</code> Circular geographical region  <em>(iOS, Android)</em></li>
<li><code>b</code> BLE Beacon <em>(iOS)</em></li>
<li><code>l</code> Loction update <em>(Android)</em></li>
</ul>
</li>
<li><code>rid</code> Region ID <em>(iOS/Android, after January 2021)</em></li>
</ul>
<h2 id="_typeconfiguration"><code>_type=configuration</code></h2>
<p>The device configuration can be imported and exported as JSON. The exported configuration can contain an array of waypoints that are defined on the device. If enabled, apps also accept remote configuration messages.</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;configuration&quot;,
    elements
}
</code></pre>
<ul>
<li><code>allowRemoteLocation</code> Respond to reportLocation cmd message <em>(iOS/boolean)</em></li>
<li><code>allowinvalidcerts</code> disable TLS certificate checks <strong>insecure</strong>  <em>(iOS/boolean)</em></li>
<li><code>auth</code> Use <code>username</code> and <code>password</code> for endpoint authentication <em>(iOS,Android/boolean)</em></li>
<li><code>autostartOnBoot</code> Autostart the app on device boot <em>(Android/boolean)</em></li>
<li><code>cleanSession</code> MQTT endpoint clean session <em>(iOS,Android/boolean)</em></li>
<li><code>clientId</code> client id to use for MQTT connect. Defaults to "<em>user</em> <em>deviceId</em>" <em>(iOS,Android/string)</em></li>
<li><code>clientpkcs</code> Name of the client pkcs12 file <em>(iOS/string)</em></li>
<li><code>cmd</code> Respond to cmd messages <em>(iOS,Android/boolean)</em></li>
<li><code>deviceId</code> id of the device used for <code>pubTopicBase</code> and <code>clientId</code> construction. Defaults to the os name of the device  <em>(iOS,Android/string)</em></li>
<li><code>downgrade</code> battery level below which to downgrade monitoring from move mode <em>(iOS/integer/percent/optional)</em></li>
<li><code>encryptionKey</code> the secret key used for <a href="../../features/encrypt/">payload encryption</a> <em>(_Android/string)</em> (on iOS the value is configured in the settings UI)</li>
<li><code>extendedData</code> Add extended data attributes to location messages <em>(iOS,Android/boolean)</em></li>
<li><code>host</code> MQTT endpoint host <em>(iOS,Android/string)</em></li>
<li><code>httpHeaders</code> extra HTTP headers:field names and field content are separated by a colon (:), multiple fields by a backslash-n (\n) \&lt;field-name&gt;:\&lt;field-content&gt;\n\&lt;field-name&gt;:\&lt;field-content&gt;... <em>(iOS only/string)</em></li>
<li><code>ignoreInaccurateLocations</code> Location accuracy below which reports are supressed <em>(iOS,Android/integer/meters)</em></li>
<li><code>ignoreStaleLocations</code> Number of days after which location updates are assumed stale. Locations sent by friends older than the number of days specified here will not be shown on map or in friends list. Defaults to 0, which means stale locations are not filtered. <em>(iOS,Android/integer/days)</em></li>
<li><code>keepalive</code> MQTT endpoint keepalive <em>(iOS,Android/integer/seconds)</em></li>
<li><code>locatorDisplacement</code> maximum distance between location source updates <em>(iOS,Android/integer/meters)</em></li>
<li><code>locatorInterval</code> maximum interval between location source updates <em>(iOS,Android/integer/seconds)</em></li>
<li><code>locatorPriority</code> source/power setting for location updates <em>(Android/integer/)</em><ul>
<li><code>0</code> NO_POWER / best accuracy possible with zero additional power consumption <em>(Android)</em></li>
<li><code>1</code> LOW_POWER / city level accuracy <em>(Android)</em></li>
<li><code>2</code> BALANCED_POWER / block level accuracy based on Wifi/Cell <em>(Android)</em></li>
<li><code>3</code> HIGH_POWER / most accurate accuracy based on GPS <em>(Android)</em></li>
</ul>
</li>
<li><code>locked</code> Locks settings screen on device for editing <em>(iOS/boolean)</em></li>
<li><code>maxHistory</code> Number of notifications to store historically. Zero (0) means no notifications are stored and history tab is hidden. Defaults to zero. <em>(iOS/integer)</em></li>
<li><code>mode</code> Endpoint protocol mode <em>(iOS,Android/integer)</em><ul>
<li><code>0</code> MQTT <em>(iOS, Android)</em></li>
<li><code>3</code> HTTP <em>(iOS, Android)</em></li>
</ul>
</li>
<li><code>monitoring</code> Location reporting mode <em>(iOS,Android/integer)</em><ul>
<li><code>-1</code> Quiet</li>
<li><code>0</code> Manual</li>
<li><code>1</code> Significant</li>
<li><code>2</code> Move</li>
</ul>
</li>
<li><code>mqttProtocolLevel</code> MQTT broker protocol level <em>(iOS,Android/integer)</em><ul>
<li><code>3</code> MQTT 3 (default)</li>
<li><code>4</code> MQTT 3.1.1</li>
<li><code>5</code> MQTT 5 (iOS only)</li>
</ul>
</li>
<li><code>notificationLocation</code> Show last reported location in ongoing notification <em>(Android/boolean)</em></li>
<li><code>opencageApiKey</code> API key for alternate Geocoding provider. See https://opencagedata.com/ for details. <em>(Android/string)</em></li>
<li><code>passphrase</code> Passphrase of the client pkcs12 file <em>(iOS/string)</em></li>
<li><code>password</code> Endpoint password <em>(iOS,Android/string)</em></li>
<li><code>ping</code> Interval in which location messages of with <code>t</code>:<code>p</code> are reported <em>(Android/integer)</em></li>
<li><code>port</code> MQTT endpoint port <em>(iOS,Android/integer)</em></li>
<li><code>positions</code> Number of locations to keep and display <em>(iOS/integer)</em></li>
<li><code>pubTopicBase</code> MQTT topic base to which the app publishes; <code>%u</code> is replaced by the user name, <code>%d</code> by device   <em>(iOS,Android/string)</em></li>
<li><code>pubRetain</code> MQTT retain flag for reported messages <em>(iOS,Android/boolean)</em></li>
<li><code>pubQos</code> MQTT QoS level for reported messages <em>(iOS,Android/integer)</em></li>
<li><code>ranging</code> Beacon ranging <em>(iOS/boolean)</em></li>
<li><code>remoteConfiguration</code> Allow remote configuration by sending a <code>setConfiguration</code> cmd message <em>(Android/boolean)</em></li>
<li><code>servercer</code> Blank separated list of certificate file names in DER format <em>(iOS/string)</em></li>
<li><code>sub</code> subscribe to <code>subTopic</code> via MQTT <em>(iOS,Android/boolean)</em></li>
<li><code>subTopic</code> A whitespace separated list of MQTT topics to which the app subscribes if <code>sub</code> is true (defaults see <a href="#topics">topics</a>)   <em>(iOS,Android/string)</em></li>
<li><code>subQos</code> <em>(iOS,Android/boolean)</em></li>
<li><code>tid</code> Two digit Tracker ID used to display short name and default face of a user <em>(iOS,Android/string)</em></li>
<li><code>tls</code> MQTT endpoint TLS connection <em>(iOS,Android/boolean)</em></li>
<li><code>tlsClientCrtPassword</code> Passphrase of the client pkcs12 file <em>(Android/string)</em></li>
<li><code>url</code> HTTP endpoint URL to which messages are POSTed <em>(iOS,Android/string)</em></li>
<li><code>username</code> Endpoint username <em>(iOS,Android/string)</em></li>
<li><code>willRetain</code></li>
<li><code>willTopic</code></li>
<li><code>willQos</code></li>
<li><code>ws</code> use MQTT over Websocket, default <code>false</code> <em>(iOS,Android/boolean)</em></li>
<li><code>waypoints</code> Array of waypoint messages <em>(iOS,Android/array)</em></li>
</ul>
<h4 id="notes_4">Notes</h4>
<ul>
<li>When importing a configuration message, all contained values are imported for the currently active mode. If the message also contains a <code>mode</code> element, the mode is changed first and all remaining elements are imported for the new mode.</li>
<li>In MQTT mode the server will consider the client as dead if it the keepalive interval plus 50% passed without receiving any MQTT packet from the client (e.g. after 90 sec if <code>keepalive</code> was 60). Afterwards, an <code>lwt</code> message will be send.</li>
</ul>
<h2 id="_typebeacon"><code>_type=beacon</code></h2>
<p>These messages are published when beacon ranging (iOS only) is enabled. Be advised that beacon ranging publishes a lot of messages and has a strong impact on battery life.</p>
<pre><code class="language-json">{
    &quot;_type&quot;:&quot;beacon&quot;,
    elements
}
</code></pre>
<ul>
<li><code>desc</code> name of the seen beacon <em>(iOS/String)</em></li>
<li><code>uuid</code> UUID of the seen beacon <em>(iOS/String)</em></li>
<li><code>major</code> Major number of the seen beacon <em>(iOS/integer/epoch)</em></li>
<li><code>minor</code> Minor number of the seen beacon <em>(iOS/integer/epoch)</em></li>
<li><code>tst</code> Timestamp at which the beacon was seen <em>(iOS/integer/epoch)</em></li>
<li><code>acc</code> Accuracy of the proximity value <em>(iOS/integer/meters)</em></li>
<li><code>rssi</code> Received signal strength of the beacon <em>(iOS/integer/decibel)</em></li>
<li><code>prox</code>Relative distance to the beacon <em>(iOS/integer)</em><ul>
<li><code>0</code> Proximity of the beacon could not be determined</li>
<li><code>1</code> Beacon is in the immediate vicinity</li>
<li><code>2</code> Beacon is relatively close to the user</li>
<li><code>3</code> Beacon is far away</li>
</ul>
</li>
</ul>
<h4 id="notes_5">Notes</h4>
<ul>
<li>The theoretical relationship between RSSI and distance is <code>RSSI[dbm] = −(10n log10(d) − A)</code> where d is the distance and A is the offset which is the measured RSSI one meter point away from the beacon.</li>
</ul>
<h2 id="_typecmd"><code>_type=cmd</code></h2>
<pre><code class="language-json">{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;reportLocation&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;reportSteps&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;dump&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;waypoints&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;clearWaypoints&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;setConfiguration&quot;, &quot;configuration&quot;:{&quot;_type&quot;:&quot;configuration&quot;,...}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;setWaypoints&quot;, &quot;waypoints&quot;:{&quot;_type&quot;:&quot;waypoints&quot;,&quot;waypoints&quot;:[...]}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;action&quot;, &quot;content&quot;:&quot;Backend maintenance scheduled for tonight\n\nhttp://support.owntracks.org&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;action&quot;, &quot;content&quot;:&quot;&lt;a href='http://support.owntracks.org'&gt;Backend Maintenance tonight&lt;/a&gt;&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;action&quot;, &quot;url&quot;:&quot;http://support.owntracks.org&quot;}
{&quot;_type&quot;:&quot;cmd&quot;, &quot;action&quot;:&quot;action&quot;, &quot;notification&quot;:&quot;Warning! Battery low&quot;}
</code></pre>
<ul>
<li><code>action</code> action to be performed by the device <em>(iOS,Android/string)</em><ul>
<li><code>action</code> Inserts an additional <em>Featured Content</em> tab in the UI <em>(iOS)</em></li>
<li><code>dump</code> Triggers the publish of a <code>configuration</code> message <em>(iOS)</em></li>
<li><code>reportSteps</code> Triggers the report of a <code>steps</code> messages_(iOS)_<ul>
<li><code>from</code> Timestamp <em>(iOS/epoch/optional)</em></li>
<li><code>to</code> Timestamp <em>(iOS/epoch/optional)</em></li>
</ul>
</li>
<li><code>reportLocation</code> Triggers the publish of a <code>location</code> messages <em>(iOS,Android)</em>
  Don‘t expect device to be online. Send with QoS&gt;0. Device will receive and repond when activated next time.</li>
<li><code>clearWaypoints</code> deletes all waypoints/regions <em>(iOS)</em></li>
<li><code>setWaypoints</code> Imports (merge) and activates new waypoints <em>(iOS,Android)</em><ul>
<li><code>waypoints</code> Array of <code>waypoint</code> messages to import <em>(iOS,Android/array/required)</em></li>
</ul>
</li>
<li><code>setConfiguration</code> Imports and activates new configuration values <em>(iOS,Android)</em><ul>
<li><code>configuration</code> Configuration message to import <em>(iOS,Android/required)</em></li>
</ul>
</li>
<li><code>waypoints</code> Triggers publish of a <code>waypoints</code> message <em>(iOS,Android)</em></li>
</ul>
</li>
</ul>
<h4 id="notes_6">Notes</h4>
<ul>
<li>If <code>url</code> for the <code>action</code> cmd message is specified, the URL is opened in a full screen web view within the app</li>
<li>If the optional <code>extern</code> boolean is <code>true</code> a click on the notification will launch an external browser instead</li>
<li>If <code>url</code> is not specified the text of the <code>content</code> element is displayed. Links embedded in the text are operational.</li>
<li>If the <code>content</code> consists of HTML, it is rendered</li>
<li>The <em>Featured Content</em> tab can be removed with an <code>action</code> cmd message without <code>content</code> and without <code>url</code> element</li>
<li>If the <code>action</code> cmd contains a <code>notification</code> element, the value of the element is shown in the app <em>(iOS)</em></li>
<li>On iOS, the array of waypoints to the <code>setWaypoints</code> command allows updates / removal; the key of the waypoint is its name (<code>desc</code>). If you specify an invalid <code>lat</code> or <code>lon</code> (invalid means out of range number value e.g. <code>-1000000</code>, a string like <code>"foo"</code> will result in a <code>0</code> in app) the waypoint is deleted.</li>
<li>On Android there's a primary key which isn't surfaced to the API, and <code>tst</code> is a uniquely-constrained value which effectively acts like a key.</li>
</ul>
<h2 id="_typesteps"><code>_type=steps</code></h2>
<pre><code class="language-json">{
    &quot;_type&quot;:&quot;steps&quot;,
    elements
}
</code></pre>
<ul>
<li><code>tst</code> Timestamp of the request <em>(iOS/integer/epoch)</em></li>
<li><code>steps</code> Steps walked with the device in the specfied time period  <em>(iOS/integer/steps)</em></li>
<li><code>from</code> Effective start of time period <em>(iOS/integer/epoch)</em></li>
<li><code>to</code>  Effective end of time period <em>(iOS/integer/epoch)</em></li>
</ul>
<h4 id="notes_7">Notes</h4>
<ul>
<li><code>steps</code> is -1 if device does not support step counting or specified time period is invalid</li>
</ul>
<h2 id="_typecard"><code>_type=card</code></h2>
<p>Apps read <a href="../../features/card/">Card</a> to display a name and icon for a user.</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;card&quot;,
    elements
}
</code></pre>
<ul>
<li><code>name</code> Name to identify a user <em>(iOS,Android/string/optional)</em></li>
<li><code>face</code> Base64 encoded PNG image that is displayed instead of the Tracker ID <em>(iOS,Android/string/optional)</em></li>
</ul>
<h2 id="_typewaypoints"><code>_type=waypoints</code></h2>
<p>The app can export a list of configured waypoints to the endpoint <code>../waypoints</code> (plural).</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;waypoints&quot;,
    elements
}
</code></pre>
<ul>
<li><code>_creator</code> Identification of what created the array. Ignored by the apps <em>(iOS,Android/string/optional)</em></li>
<li><code>waypoints</code> Array of <code>waypoint</code> messages <em>(iOS,Android/array/required)</em></li>
</ul>
<h2 id="_typeencrypted"><code>_type=encrypted</code></h2>
<p>Apps can optionally <a href="../../features/encrypt/">encrypt</a> outgoing messages with a shared symmetric key.  The encrypted message is contained in the <code>data</code>element.
For security reasons, the encryption key is not exported with configuration messages and cannot be imported.</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;encrypted&quot;,
    elements
}
</code></pre>
<ul>
<li><code>data</code> Encrypted and Base64 encoded original JSON message <em>(iOS,Android/string/required)</em></li>
</ul>
<h2 id="_typerequest"><code>_type=request</code></h2>
<p>Apps can request the creation of <a href="../../features/tours/">tours</a> which elicit a <code>cmd</code> response from the Recorder. See <a href="../../features/tours/">tours</a> for the details.</p>
<pre><code class="language-json">{
  &quot;_type&quot;: &quot;request&quot;,
  &quot;request&quot;: &quot;tour&quot;,
  &quot;tour&quot;: {
    ...
  }
}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../features/location/" class="btn btn-neutral float-left" title="Location"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../http/" class="btn btn-neutral float-right" title="HTTP">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/owntracks/booklet" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../features/location/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../http/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
