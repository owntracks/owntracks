<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="OwnTracks.org" /><link rel="canonical" href="http://owntracks.org/features/waypoints/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Waypoints - OwnTracks Booklet</title>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link href="../../extra.css" rel="stylesheet">
    
      <script>
        // Current page data
        var mkdocs_page_name = "Waypoints";
        var mkdocs_page_input_path = "features/waypoints.md";
        var mkdocs_page_url = "/features/waypoints/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> OwnTracks Booklet
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Intro</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/whathow/">What it does</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/quicksetup/">Quicksetup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/apps/">Apps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../comparison/">Comparison</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../location/">Location</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tech/json/">JSON</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tech/http/">HTTP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tech/program/">Code</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sundry</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../privacy/">Privacy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../people/">People</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/">Answers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../press/">Press</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">OwnTracks Booklet</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Waypoints</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/owntracks/booklet/edit/master/docs/features/waypoints.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="regions-waypoints">Regions (Waypoints)<a class="headerlink" href="#regions-waypoints" title="Permanent link">#</a></h2>
<p>A <em>region</em>, <em>geofence</em>, or <em>waypoint</em> (sadly we've used these terms interchangeably) is a circular area you configure in the UI on your OwnTracks device. The device then begins monitoring whether the area is being entered or left and it will publish what we call a <em>transition event</em> accordingly.</p>
<p>The <em>base topic</em> for publishes from the OwnTracks apps is what you've configured it to be in the apps' preferences / settings. This base topic is used for publishes of type <code>location</code> (see <a href="../../tech/json/">JSON</a>). All messages published to this base topic are retained if you have configured the app to retain them.</p>
<p>So upon entering or leaving a region, the device publishes a transition event which contains:</p>
<table>
<thead>
<tr>
<th>element</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>desc</code></td>
<td>description with the name you set for the waypoint</td>
</tr>
<tr>
<td><code>event</code></td>
<td><code>"enter"</code> or <code>"leave"</code>, depending on whether the <br />device is entering or leaving a configured region, respectively.</td>
</tr>
<tr>
<td><code>rid</code></td>
<td>the <em>region ID</em> of the region</td>
</tr>
<tr>
<td><code>lat</code>, <code>lon</code></td>
<td>where the region was detected (entering respectively leaving)</td>
</tr>
<tr>
<td><code>tid</code></td>
<td>trackerID</td>
</tr>
<tr>
<td><code>tst</code></td>
<td>timestamp when the event was published</td>
</tr>
<tr>
<td><code>wtst</code></td>
<td>the time stamp of when the region was created</td>
</tr>
</tbody>
</table>
<p>For example, this JSON might be published when entering a region:</p>
<pre><code class="language-json">{
      &quot;_type&quot;: &quot;transition&quot;,
      &quot;desc&quot;: &quot;My favorite coffee shop (Delaville)&quot;,
      &quot;event&quot;: &quot;enter&quot;,
      &quot;lat&quot;: 48.87069,
      &quot;lon&quot;: 2.34916,
      &quot;rid&quot;: &quot;f7676c&quot;,
      &quot;tid&quot;: &quot;j1&quot;,
      &quot;tst&quot;: 1707057574,
      &quot;wtst&quot;: 1610104395
}
</code></pre>
<p>If you set up a region (or waypoint or geo-fence, you get the drift), the app publishes that region (with <code>retain=0</code> irrespective of your general preference) to the base topic with <code>/waypoint</code> tacked onto the topic (e.g. <code>owntracks/&lt;user&gt;/&lt;device&gt;/waypoint</code>) with the payload for <code>_type=waypoint</code> as specified in the <a href="../../tech/json/">JSON page</a>. Entering or leaving a waypoint will be published as a <code>transition</code> message and will contain a <code>wtst</code> (for historical purposes) with the timestamp of when the region was originally defined. (Note that that branch is <code>/waypoint</code> -- singular.)</p>
<p>For example, If Jane configures a region on her iPhone, the app could publish the following payload to <code>owntracks/jane/phone/waypoint</code>:</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;waypoint&quot;,
    &quot;desc&quot;: &quot;My favorite coffee shop (Delaville)&quot;,
    &quot;lat&quot;: 48.87069,
    &quot;lon&quot;: 2.34916,
    &quot;rad&quot;: &quot;50&quot;,
    &quot;tst&quot;: &quot;1385997757&quot;,
    &quot;rid&quot;: &quot;f7676c&quot;,
    &quot;wtst&quot;: 1610104395
}
</code></pre>
<p>When you set up a region (with a <code>desc</code>ription and a <code>rad</code>ius), this new
region is published to the broker with the current time stamp. If you update
the region definition on the device at a later stage, the region is
re-published, with the <em>original</em> timestamp, but with possibly new
<code>desc</code>ription and/or <code>rad</code>ius and <code>lat</code>itude / <code>lon</code>gitude, but with the same
<code>rid</code>. To be precise, the <code>rid</code> (region ID) is used as an
identifier of the region even if it is later modified on the device.</p>
<p>Subscribers to the broker (our apps and any other program) can avoid getting
regions by subscribing to, say, <code>owntracks/+/+</code>; also broker ACLs can
prohibit access to <code>owntracks/+/+/waypoint</code> for particular users if so desired.
Conversely, all messages published by the apps (<code>location</code>, <code>transition</code>, and <code>waypoint</code>) are available with a subscription to <code>owntracks/#</code>.</p>
<p>The OwnTracks apps may keep track of regions, e.g. for displaying to users. </p>
<h3 id="in-regions">In regions<a class="headerlink" href="#in-regions" title="Permanent link">#</a></h3>
<p>When the apps publish a <code>_type = location</code> message, they add to that an array
called <code>inregions</code> (and as from January 2021 an array called <code>inrids</code>) with
the names of the regions and their respective <code>rid</code>s. The <code>inregions</code> array
might be consumed by humans whereas the <code>inrids</code> array would be consumed by
developers who will wish to associate the region IDs (<code>rid</code>) with the values in
<code>inrids</code>.</p>
<h3 id="adding-on-ios">Adding on iOS<a class="headerlink" href="#adding-on-ios" title="Permanent link">#</a></h3>
<p>On iOS you can navigate to the place where you want to place a region, Tap long and edit the Region. The region gets a default name (<code>Here ..</code>) which you will want to change to something meaningful. With a bit of practice, you can then drag the region to it's final destination on the map or, and this may be easier, edit the region and specify its exact coordinates.</p>
<h3 id="adding-on-android">Adding on Android<a class="headerlink" href="#adding-on-android" title="Permanent link">#</a></h3>
<p>On Android, regions can be configured on a separate activity. Coordinates for the geographical region can be entered by hand or by using the place picker.  </p>
<h3 id="remote-loading-of-regions">Remote loading of regions<a class="headerlink" href="#remote-loading-of-regions" title="Permanent link">#</a></h3>
<p>Instead of configuring multiple regions on the device, they can be loaded <a href="../remoteconfig/">remotely</a> with the <code>setWaypoints</code> cmd message if remote configuration is enabled on the device. </p>
<p>You can use this to import individual regions or groups of pre-configured regions which are merged into the existing regions definition on the device. Recall, however, that the <code>rid</code> element is like a <em>key</em> which uniquely identifies each region / waypoint; leave it unchanged when modifying and resubmitting a waypoint.</p>
<pre><code class="language-json">{
    &quot;_type&quot;: &quot;cmd&quot;,
    &quot;action&quot;: &quot;setWaypoints&quot;,
    &quot;waypoints&quot;: {
        &quot;_type&quot;: &quot;waypoints&quot;,
        &quot;waypoints&quot;: [
            {
                &quot;_type&quot;: &quot;waypoint&quot;,
                &quot;tst&quot;: 1708625557,
                &quot;rid&quot;: &quot;my-region-id-1&quot;,
                &quot;desc&quot;: &quot;home&quot;,
                &quot;rad&quot;: 100,
                &quot;lat&quot;: 30.0,
                &quot;lon&quot;: 40.0
            },
            {
                &quot;_type&quot;: &quot;waypoint&quot;,
                &quot;tst&quot;: 1708625558,
                &quot;rid&quot;: &quot;my-region-id-2&quot;,
                &quot;desc&quot;: &quot;work&quot;,
                &quot;rad&quot;: 100,
                &quot;lat&quot;: 30.1,
                &quot;lon&quot;: 40.1
            }
        ]
    }
}
</code></pre>
<p>Assuming the above is in a file named <code>wp.json</code>, a user can publish that to themselves (or an authorized user to any other) as follows (note the use of <code>jq -c</code> which ensures a single line of JSON and the benefit that <code>jq</code> verifies for valid JSON):</p>
<pre><code class="language-console">$ jq -c . wp.json |
      mosquitto_pub -u username -P 'password' -t owntracks/jane/nokia/cmd -q 1 -l
</code></pre>
<h3 id="deleting-regions">Deleting regions<a class="headerlink" href="#deleting-regions" title="Permanent link">#</a></h3>
<p>On iOS a region can be deleted by swiping it away. On Android, a long press is required. Note that deleting a region on the device does not publish anything to the MQTT broker or HTTP server.</p>
<h3 id="beacons-ranging">Beacons Ranging<a class="headerlink" href="#beacons-ranging" title="Permanent link">#</a></h3>
<p>In addition to circular regions, the iOS app can monitor its proximity to <a href="../beacons/">BLE Beacons</a>. </p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/owntracks/booklet" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
